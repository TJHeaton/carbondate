<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="carbondate">
<title>Poisson Process Modelling • carbondate</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Poisson Process Modelling">
<meta property="og:description" content="carbondate">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">carbondate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/carbondate.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Independent_calibration.html">Independent and Joint Radiocarbon Calibration</a>
    <a class="dropdown-item" href="../articles/Against_SPDs.html">Why Not to Use SPDs</a>
    <a class="dropdown-item" href="../articles/Non-parametric-summed-density.html">Non-Parametric Joint Density Estimation</a>
    <a class="dropdown-item" href="../articles/Poisson-process-modelling.html">Poisson Process Modelling</a>
    <a class="dropdown-item" href="../articles/determining-convergence.html">Determining Convergence</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/TJHeaton/carbondate/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Poisson Process Modelling</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/TJHeaton/carbondate/blob/HEAD/vignettes/Poisson-process-modelling.Rmd" class="external-link"><code>vignettes/Poisson-process-modelling.Rmd</code></a></small>
      <div class="d-none name"><code>Poisson-process-modelling.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/TJHeaton/carbondate" class="external-link">carbondate</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<!-- badges: start -->
<!-- badges: end -->
<p>This component of the library allows you to model (and estimate) the
occurrence of radiocarbon samples as a variable-rate (inhomogeneous)
Poisson process. This is done using the function
<code>PPcalibrate</code>. The aim of this function is primarily to allow
a user to estimate the variable (calendar year) rate at which a set of
radiocarbon samples are observed, and identify changepoints in that
rate.</p>
<p>This Poisson process model can also be used in a
<em>“dates-as-data”</em> approach <span class="citation">(Rick
1987)</span> to provide a proxy for changes in population or activity,
dependent upon the representativeness of the underlying sampling. For
this method, the estimated rate of the Poisson process provides the
proxy.</p>
<!--- Similarly to the ,

Similarly to the Bayesian non-parametric approach, and 

Dependent upon the representativeness of the underlying sampling, the Poisson process's rate 

approach can be used via a _"dates-as-data"_ approach [@rick1987] to provide a proxy for changes in population or activity. Here the Poisson process's occurrence rate provides the proxy. --->
<!--- Radiocarbon Calibration Of Multiple $^{14}$C Samples Using Reversible Jump MCMC and a Poisson process -->
<div class="section level3">
<h3 id="modelling-ideas">Modelling Ideas<a class="anchor" aria-label="anchor" href="#modelling-ideas"></a>
</h3>
<p>Suppose we have a series of <span class="math inline">\(n\)</span>
events, which occur at calendar times <span class="math inline">\(\{\theta_i, i= 1,\ldots,n \}\)</span> cal yr BP.
Each event is assumed to result in the generation of a radiocarbon
sample, <span class="math inline">\(\{ X_i, i= 1,\ldots,n \}\)</span>.
Examples of events might be:</p>
<ul>
<li>death of an animal (which leaves a bone)</li>
<li>creation of a cave painting (which leaves a painting)</li>
<li>construction of a settlement (which leaves a farmstead)</li>
<li>a palaeofire (which leaves behind charcoal)</li>
</ul>
<p>We model the occurrence of these events as random and aim to
investigate whether, and how, the rate at which they occur varies over
calendar time.</p>
<p>Specifically, we assume that the events occur according to a Poisson
Process with a variable rate <span class="math inline">\(\lambda(t)\)</span>. This rate <span class="math inline">\(\lambda(t)\)</span> is considered
piecewise-constant, but changes an unknown number of times and at
unknown calendar ages. We aim to estimate <span class="math inline">\(\lambda(t)\)</span> and hence infer how the rate
at which the events occur changes over calendar time. Time periods where
the rate <span class="math inline">\(\lambda(t)\)</span> is high will
typically be expected to generate a greater number of events (perhaps
since there is more activity, or a greater population, at the
site/sites); while periods when the rate <span class="math inline">\(\lambda(t)\)</span> is lower (perhaps due to lower
activity at the site/sites) will be expected to have fewer events.</p>
<p>When the calendar ages of the events <span class="math inline">\(\{\theta_i , i=1,\ldots,n\}\)</span> are known
exactly, estimation of the variable rate <span class="math inline">\(\lambda(t)\)</span> can be tackled directly via
reversible jump Markov Chain Monte Carlo (RJ-MCMC) <span class="citation">(Green 1995)</span>. However, when we only observe the
radiocarbon ages of the samples (<span class="math inline">\(\{ X_i, i=
1,\ldots,n \}\)</span>) the underlying calendar ages <span class="math inline">\(\theta_i\)</span> are uncertain and must be
estimated via radiocarbon calibration. This complicates the process of
estimating <span class="math inline">\(\lambda(t)\)</span> especially as
the calibration must be done simultaneously to its estimation (as the
modelling will influence the set of <span class="math inline">\(\theta_i\)</span> and vice versa). In this
library, we provide a rigorous approach to the estimation of <span class="math inline">\(\lambda(t)\)</span>.</p>
<div class="figure">
<img src="Poisson-process-modelling_files/figure-html/illustrate_PP-1.png" alt="_Modelling sample occurence using a Poisson process with a latent occurence/activity rate.  Left Panel: An illustration of a Poisson process with two changepoints in the occurrence rate. The samples (shown as a rug in purple) occur at random calendar times, but proportional to the underlying occurrence rate. There are therefore more samples between (2700, 2300) cal yr BP  than other times. Right Panel: Each sample has a ^14^C age (shown as black ticks on the y-axis). We wish to reconstruct the underlying Poisson process rate given only these ^14^C determination._" width="100%"><p class="caption">
<em>Modelling sample occurence using a Poisson process with a latent
occurence/activity rate. Left Panel: An illustration of a Poisson
process with two changepoints in the occurrence rate. The samples (shown
as a rug in purple) occur at random calendar times, but proportional to
the underlying occurrence rate. There are therefore more samples between
(2700, 2300) cal yr BP than other times. Right Panel: Each sample has a
<sup>14</sup>C age (shown as black ticks on the y-axis). We wish to
reconstruct the underlying Poisson process rate given only these
<sup>14</sup>C determination.</em>
</p>
</div>
</div>
<div class="section level3">
<h3 id="an-inhomogeneous-poisson-process">An Inhomogeneous Poisson process<a class="anchor" aria-label="anchor" href="#an-inhomogeneous-poisson-process"></a>
</h3>
<p>A Poisson process is a common statistical process used to model the
occurrence of random events. It is described by specifying the random
variables <span class="math inline">\(N(s,t)\)</span> for <span class="math inline">\(0 \leq s \leq t\)</span>, where <span class="math inline">\(N(s,t)\)</span> represents the number of events
that have occurred in the time interval <span class="math inline">\((s,t]\)</span>. Any Poisson process has a
parameter <span class="math inline">\(\lambda(t)\)</span>, known as the
rate of the process. This controls the expected number of events in a
particular time interval.</p>
<p>In the case of an inhomogeneous Poisson process, the rate <span class="math inline">\(\lambda(t)\)</span> varies over time so that some
time periods are expected to have a greater number of event than others.
An (inhomogeneous) Poisson process is then defined by the following two
properties:</p>
<ul>
<li>For any <span class="math inline">\(0 \leq s \leq t\)</span>, the
distribution of <span class="math inline">\(N(s,t)\)</span> is Poisson
with parameter <span class="math inline">\(\int_{\theta = s}^t
\lambda(\theta) d\theta\)</span>.</li>
<li>If <span class="math inline">\((s_1,t_1] , (s_2,t_2 ], \ldots
,(s_n,t_n]\)</span> are disjoint intervals (i.e., non-overlapping) then
<span class="math inline">\(N(s_1,t_1),N(s_2,t_2 ),\ldots
,N(s_n,t_n)\)</span> are independent random variables.</li>
</ul>
<p>In particular, the first of these properties implies that the
expected number of events in a specific time interval <span class="math inline">\((s,t]\)</span> is <span class="math inline">\(\int_{\theta = s}^t \lambda(\theta)
d\theta\)</span>. Hence time periods with higher rates <span class="math inline">\(\lambda(t)\)</span> will be expected to have
greater number of events. The second implies that, conditional on the
rate <span class="math inline">\(\lambda(t)\)</span>, the number of
events that have occurred in one time period is not affected by the
number of events in a different, and non-overlapping time period. It
also implies that events are not clustered beyond the effect of the
variable rate, e.g., the occurrence of one event does not
increase/decrease the probability that another event occurs shortly
afterwards. Note that this last assumption is quite strong as clustering
might occur in many instances, for example if the animal bones you date
all result from the hunting of a single (short-lived) group of
individuals, or you date multiple buildings in a settlement.</p>
</div>
<div class="section level3">
<h3 id="final-radiocarbon-model">Final Radiocarbon Model<a class="anchor" aria-label="anchor" href="#final-radiocarbon-model"></a>
</h3>
<p>Given a set of multiple <span class="math inline">\(^{14}\)</span>C
samples, <span class="math display">\[X_1, \ldots, X_n\]</span> the
function <code>PPcalibrate</code> will simultaneously:</p>
<ul>
<li>calibrate them to provide posterior calendar ages estimates <span class="math inline">\(\theta_1, \ldots, \theta_n\)</span>
</li>
<li>estimate the rate <span class="math inline">\(\lambda(t)\)</span> of
the underlying process. This estimate <span class="math inline">\(\hat{\lambda}(t)\)</span> may provide a useful
proxy to make archaeological and/or environmental inference, e.g., to
model changes in culture, or useage, or population size over time.</li>
</ul>
<p>The (calendar) rate at which the samples occur is modelled as a
Poisson process with a variable rate <span class="math inline">\(\lambda(t)\)</span>. Specifically, <span class="math inline">\(\lambda(t)\)</span> is modelled as a piecewise
constant function with an unknown number of changepoints: <span class="math display">\[
\lambda(t) = \left\{ \begin{array}{ll}
  h_i \quad &amp; \textrm{if } s_i \leq t &lt; s_{i+1} \\
  0 &amp; \textrm{otherwise}
  \end{array} \right.
\]</span> where <span class="math inline">\(T_A &lt; s_1 &lt; s_2 &lt;
\ldots &lt; s_k &lt; T_B\)</span> are the calendar ages at which there
are changes in the Poisson process rate, and <span class="math inline">\(T_A\)</span> and <span class="math inline">\(T_B\)</span> are bounding calendar ages. We use
reversible jump MCMC (RJMCMC) to alternate between calibrating the
samples and updating the estimate of the underlying rate lambda.</p>
</div>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>This is a basic example which shows you how to solve a common
problem. In this simulated example, we will assume that the events
(samples) can must lie within the calendar period from [700, 300] cal yr
BP. Within this period, we will create 40 artificial samples with <span class="math inline">\(^{14}\)</span>C determinations corresponding to
the (narrower) calendar period from [550, 500] cal yr BP. Effectively,
the underlying model is a Poisson process with a rate <span class="math display">\[
\lambda(t)  \left\{ \begin{array}{ll}
  h_1 = 0 &amp; \textrm{if } 300 \leq t &lt; 500 \textrm{ cal yr BP} \\
  h_2 \qquad &amp; \textrm{if } 500 \leq t &lt; 550 \textrm{ cal yr
BP}\\
  h_3 = 0 &amp; \textrm{if } 550 \leq t &lt; 700 \textrm{ cal yr BP}
  \end{array} \right.
\]</span> We will then investigate if we can reconstruct this underlying
information, from just the <span class="math inline">\(^{14}\)</span>C
values, if we only knew that the calendar ages of the samples lay
between the bounding [700, 300] cal yr BP.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set initial values </span></span>
<span><span class="va">n_observed</span> <span class="op">&lt;-</span> <span class="fl">40</span></span>
<span><span class="va">rc_sigmas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">15</span>, <span class="va">n_observed</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create artificial rc_determinations</span></span>
<span><span class="va">calendar_age_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">700</span><span class="op">)</span> </span>
<span><span class="va">observed_age_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">550</span><span class="op">)</span> </span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span></span>
<span>      from <span class="op">=</span> <span class="va">observed_age_range</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>      to <span class="op">=</span> <span class="va">observed_age_range</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>      length <span class="op">=</span> <span class="va">n_observed</span><span class="op">)</span></span>
<span><span class="va">intcal_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approx</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">intcal20</span><span class="op">$</span><span class="va">calendar_age_BP</span>,</span>
<span>      y <span class="op">=</span> <span class="va">intcal20</span><span class="op">$</span><span class="va">c14_age</span>,</span>
<span>      xout <span class="op">=</span> <span class="va">true_theta</span><span class="op">)</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">intcal_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approx</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">intcal20</span><span class="op">$</span><span class="va">calendar_age_BP</span>,</span>
<span>      y <span class="op">=</span> <span class="va">intcal20</span><span class="op">$</span><span class="va">c14_sig</span>,</span>
<span>      xout <span class="op">=</span> <span class="va">true_theta</span><span class="op">)</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">rc_determinations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span></span>
<span>      n <span class="op">=</span> <span class="va">n_observed</span>,</span>
<span>      mean <span class="op">=</span> <span class="va">intcal_mean</span>,</span>
<span>      sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">rc_sigmas</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">intcal_sd</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model</span></span>
<span><span class="va">PP_fit_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PPcalibrate.html">PPcalibrate</a></span><span class="op">(</span></span>
<span>    rc_determinations <span class="op">=</span> <span class="va">rc_determinations</span>,</span>
<span>    rc_sigmas <span class="op">=</span> <span class="va">rc_sigmas</span>,</span>
<span>    calibration_curve <span class="op">=</span> <span class="va">intcal20</span>,</span>
<span>    calendar_age_range <span class="op">=</span> <span class="va">calendar_age_range</span>,</span>
<span>    calendar_grid_resolution <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    n_iter <span class="op">=</span> <span class="fl">1e5</span>,</span>
<span>    n_thin <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    show_progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>This creates an object <code>PP_fit_output</code> which you can
access directly or use the in-built plotting functions.</p>
<div class="section level4">
<h4 id="plotting-the-posterior-estimate-of-the-occurrence-rate">Plotting the posterior estimate of the occurrence rate<a class="anchor" aria-label="anchor" href="#plotting-the-posterior-estimate-of-the-occurrence-rate"></a>
</h4>
<p>To plot the posterior estimate of <span class="math inline">\(\lambda(t)\)</span> you should use the in-built
function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotPosteriorMeanRate.html">PlotPosteriorMeanRate</a></span><span class="op">(</span><span class="va">PP_fit_output</span><span class="op">)</span></span></code></pre></div>
<p><img src="Poisson-process-modelling_files/figure-html/meanrate-1.png" width="100%"></p>
<p>This plots the posterior mean rate of sample occurrence (shown in
purple). The <span class="math inline">\(^{14}\)</span>C determinations
(<span class="math inline">\(X_1, \ldots, X_n\)</span>) are shown on the
y-axis as a rug. The rug on the x-axis plots the posterior mean of the
corresponding calendar ages (i.e., <span class="math inline">\(\theta_1,
\ldots, \theta_n\)</span>) after calibration for illustration purposes.
<strong>Note</strong>: In some cases (in particular when an individual
calibrated age estimates <span class="math inline">\(\theta_i\)</span>
is bimodal) the posterior calendar mean will not be a good summary.</p>
<p>As you can see, the posterior estimate of <span class="math inline">\(\lambda(t)\)</span> identifies the calendar period
from which the hypothetical samples have been created [550, 500] cal yr
BP. Here, <span class="math inline">\(\hat{\lambda}(t)\)</span> is
non-zero, while for the other time periods the rate (correctly) drops to
near zero.</p>
</div>
<div class="section level4">
<h4 id="plotting-the-estimated-number-of-changepoints">Plotting the estimated number of changepoints<a class="anchor" aria-label="anchor" href="#plotting-the-estimated-number-of-changepoints"></a>
</h4>
<p>You can plot the posterior estimate for the number of internal
changes in the rate <span class="math inline">\(\lambda(t)\)</span>
using the command:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotNumberOfInternalChanges.html">PlotNumberOfInternalChanges</a></span><span class="op">(</span><span class="va">PP_fit_output</span><span class="op">)</span></span></code></pre></div>
<p><img src="Poisson-process-modelling_files/figure-html/changepoint_number-1.png" width="100%"></p>
<p>Here, we can see that the method estimates that there are most likely
to be two changes. Again, this corresponds to the underlying (simulated)
data, where there is a step up from a occurrence rate of zero
samples/cal yr to a rate of <em>ca.</em> 0.8 samples/cal yr at 550 cal
yr BP, and then a step back down to return to a sample occurrence rate
of zero at 500 cal yr BP.</p>
</div>
<div class="section level4">
<h4 id="plotting-estimates-of-changepoint-locations">Plotting estimates of changepoint locations<a class="anchor" aria-label="anchor" href="#plotting-estimates-of-changepoint-locations"></a>
</h4>
<p>You can also plot density estimates for the locations (calendar
times) of the changepoints in <span class="math inline">\(\lambda(t)\)</span>, conditional on the number of
such changes. The default shows the density estimates for the calendar
times at which there are changes in the occurrence rate, conditional on
their being <span class="math inline">\(n_{\textrm{internal changes}} =
1, 2,\)</span> and <span class="math inline">\(3\)</span> such changes
in <span class="math inline">\(\lambda(t)\)</span> over the time period
under study.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotPosteriorChangePoints.html">PlotPosteriorChangePoints</a></span><span class="op">(</span><span class="va">PP_fit_output</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in PlotPosteriorChangePoints(PP_fit_output): No posterior samples with</span></span>
<span><span class="co">#&gt; 1 internal changes</span></span></code></pre></div>
<p><img src="Poisson-process-modelling_files/figure-html/changepoint_locations-1.png" width="100%"></p>
<p>This figure can be interpreted as follows. For example, if the model
thinks there are only two changepoints in the underlying occurrence rate
of the samples, then these changepoints should be located around 500 cal
yr BP and 550 cal yr BP (the two distinct dashed density estimates shown
in dark green). If the model thinks there are three changepoints in the
rate, then these should be located according to the location shown by
the dotted red densities (note that here these three locations overlay
one another, effectively adding a double changepoint at either 500 or
550 cal yr BP).</p>
<p>The information contained in this plot should be combined with that
in <code>PlotNumberOfInternalChanges</code> which indicates that the
most likely number of changepoints is two. We may therefore wish to
focus our interpretation on the locations/times of changepoints
conditional on their being this number (i.e., when <span class="math inline">\(n_{\textrm{internal changes}} = 2\)</span>).</p>
<p><strong>Note the R warning here:</strong> For this simulated data,
the posterior model (correctly) never thinks there should be only one
changepoint. This is indicated by the warning message returned by R and
the absence of a solid blue density in the plot.</p>
</div>
<div class="section level4">
<h4 id="plotting-estimates-of-occurrence-rate">Plotting estimates of occurrence rate<a class="anchor" aria-label="anchor" href="#plotting-estimates-of-occurrence-rate"></a>
</h4>
<p>You can also plot, conditional on the number of changes in the rate
step function <span class="math inline">\(\lambda(t)\)</span>, the
posterior density estimates for the heights in each of the individual
segments (i.e., the rates of sample occurrence in those constant
periods)</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotPosteriorHeights.html">PlotPosteriorHeights</a></span><span class="op">(</span><span class="va">PP_fit_output</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in PlotPosteriorHeights(PP_fit_output): No posterior samples with 1</span></span>
<span><span class="co">#&gt; internal changes</span></span></code></pre></div>
<p><img src="Poisson-process-modelling_files/figure-html/changepoint_rates-1.png" width="100%"></p>
<p>Here, conditional on there being two changes in <span class="math inline">\(\lambda(t)\)</span> between 700–300 cal yr BP (so
three different values for the rates) we have two rates of <em>ca.</em>
0 events per cal yr (these correspond to the periods 700–550 and 500–300
cal yr BP), and a period with rate <em>ca.</em> 0.6-0.8 events per cal
yr (corresponding to the period from 550–500 cal yr BP).</p>
</div>
<div class="section level4">
<h4 id="plotting-the-posterior-calendar-age-estimates-of-individual-samples">Plotting the posterior calendar age estimates of individual
samples<a class="anchor" aria-label="anchor" href="#plotting-the-posterior-calendar-age-estimates-of-individual-samples"></a>
</h4>
<p>Finally, it is again possible to plot the posterior calendar age
estimates of and individual samples using the
<code>PlotCalendarAgeDensityIndividualSample</code> function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotCalendarAgeDensityIndividualSample.html">PlotCalendarAgeDensityIndividualSample</a></span><span class="op">(</span></span>
<span>  <span class="fl">9</span>, <span class="va">PP_fit_output</span>, show_hpd_ranges <span class="op">=</span> <span class="cn">TRUE</span>, show_unmodelled_density <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Poisson-process-modelling_files/figure-html/PP_plot_individual-1.png" width="100%"></p>
</div>
</div>
<div class="section level3">
<h3 id="changing-the-calendar-age-plotting-scale">Changing the calendar age plotting scale<a class="anchor" aria-label="anchor" href="#changing-the-calendar-age-plotting-scale"></a>
</h3>
<p>As elsewhere in the library, the calendar age scale (cal yr BP, cal
AD, or cal BC) shown when plotting can be selected via the
<code>plot_cal_age_scale</code> variable within the relevant functions.
In the case of the Poisson process modelling, the calendar age scale can
be set in <code>PlotPosteriorMeanRate</code> and
<code>PlotPosteriorChangePoints</code>, e.g.,</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotPosteriorChangePoints.html">PlotPosteriorChangePoints</a></span><span class="op">(</span><span class="va">PP_fit_output</span>, </span>
<span>                          plot_cal_age_scale <span class="op">=</span> <span class="st">"AD"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in PlotPosteriorChangePoints(PP_fit_output, plot_cal_age_scale = "AD"):</span></span>
<span><span class="co">#&gt; No posterior samples with 1 internal changes</span></span></code></pre></div>
<p><img src="Poisson-process-modelling_files/figure-html/changepoint_locations_AD-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-green1995" class="csl-entry">
Green, Peter J. 1995. <span>“Reversible Jump Markov Chain Monte Carlo
Computation and Bayesian Model Determination.”</span>
<em>Biometrika</em> 82 (4): 711–32. <a href="https://doi.org/10.2307/2337340" class="external-link">https://doi.org/10.2307/2337340</a>.
</div>
<div id="ref-rick1987" class="csl-entry">
Rick, John W. 1987. <span>“Dates as Data: An Examination of the Peruvian
Preceramic Radiocarbon Record.”</span> <em>American Antiquity</em> 52
(1): 55–73. <a href="https://www.cambridge.org/core/journals/american-antiquity/article/abs/dates-as-data-an-examination-of-the-peruvian-preceramic-radiocarbon-record/01A2247C02E83426761D922297442C36" class="external-link">https://www.cambridge.org/core/journals/american-antiquity/article/abs/dates-as-data-an-examination-of-the-peruvian-preceramic-radiocarbon-record/01A2247C02E83426761D922297442C36</a>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Timothy J Heaton, Sara Al-assam.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
