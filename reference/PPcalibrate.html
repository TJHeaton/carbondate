<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Model Occurrence of Multiple Radiocarbon Samples as a Variable-Rate Poisson Process — PPcalibrate • carbondate</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Model Occurrence of Multiple Radiocarbon Samples as a Variable-Rate Poisson Process — PPcalibrate"><meta name="description" content='This function calibrates a set of radiocarbon (\({}^{14}\)C) samples, and provides an estimate
of how the underlying rate at which the samples occurred varies over calendar time (including any
specific changepoints in the rate). The method can be used as an alternative approach to summarise
calendar age information contained in a set of related \({}^{14}\)C samples, enabling inference
on the latent activity rate which led to their creation.
It takes as an input a set of \({}^{14}\)C determinations and associated \(1\sigma\)
uncertainties, as well as the radiocarbon age calibration curve to be used. The (calendar age)
occurrence of these radiocarbon (\({}^{14}\)C) samples is modelled as a Poisson process. The
underlying rate of this Poisson process \(\lambda(t)\), which represents the rate at which the
samples occurred, is considered unknown and assumed to vary over calendar time.
Specifically, the sample occurrence rate \(\lambda(t)\) is modelled as piecewise constant, but with
an unknown number of changepoints, which can occur at unknown times. The value of \(\lambda(t)\)
between any set of changepoints is also unknown. The function jointly calibrates the given \({}^{14}\)C
samples under this model, and simultaneously provides an estimate of \(\lambda(t)\). Fitting is performed
using reversible-jump MCMC within Gibbs.
It returns estimates for the calendar age of each individual radiocarbon sample in the input set;
and broader output on the estimated value of \(\lambda(t)\) which can be used by other library functions.
Analysis of the estimated changepoints in the piecewise \(\lambda(t)\) permits wider inference on whether
the occurrence rate of samples changed significantly at any particular calendar time and, if so, when and
by how much.
For more information read the vignette:
vignette("Poisson-process-modelling", package = "carbondate")'><meta property="og:description" content='This function calibrates a set of radiocarbon (\({}^{14}\)C) samples, and provides an estimate
of how the underlying rate at which the samples occurred varies over calendar time (including any
specific changepoints in the rate). The method can be used as an alternative approach to summarise
calendar age information contained in a set of related \({}^{14}\)C samples, enabling inference
on the latent activity rate which led to their creation.
It takes as an input a set of \({}^{14}\)C determinations and associated \(1\sigma\)
uncertainties, as well as the radiocarbon age calibration curve to be used. The (calendar age)
occurrence of these radiocarbon (\({}^{14}\)C) samples is modelled as a Poisson process. The
underlying rate of this Poisson process \(\lambda(t)\), which represents the rate at which the
samples occurred, is considered unknown and assumed to vary over calendar time.
Specifically, the sample occurrence rate \(\lambda(t)\) is modelled as piecewise constant, but with
an unknown number of changepoints, which can occur at unknown times. The value of \(\lambda(t)\)
between any set of changepoints is also unknown. The function jointly calibrates the given \({}^{14}\)C
samples under this model, and simultaneously provides an estimate of \(\lambda(t)\). Fitting is performed
using reversible-jump MCMC within Gibbs.
It returns estimates for the calendar age of each individual radiocarbon sample in the input set;
and broader output on the estimated value of \(\lambda(t)\) which can be used by other library functions.
Analysis of the estimated changepoints in the piecewise \(\lambda(t)\) permits wider inference on whether
the occurrence rate of samples changed significantly at any particular calendar time and, if so, when and
by how much.
For more information read the vignette:
vignette("Poisson-process-modelling", package = "carbondate")'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">carbondate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/carbondate.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Independent_calibration.html">Independent and Joint Radiocarbon Calibration</a></li>
    <li><a class="dropdown-item" href="../articles/Against_SPDs.html">Why Not to Use SPDs</a></li>
    <li><a class="dropdown-item" href="../articles/Non-parametric-summed-density.html">Non-Parametric Joint Density Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/Poisson-process-modelling.html">Poisson Process Modelling</a></li>
    <li><a class="dropdown-item" href="../articles/determining-convergence.html">Determining Convergence</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/TJHeaton/carbondate/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Model Occurrence of Multiple Radiocarbon Samples as a Variable-Rate Poisson Process</h1>
      <small class="dont-index">Source: <a href="https://github.com/TJHeaton/carbondate/blob/main/R/PPcalibrate.R" class="external-link"><code>R/PPcalibrate.R</code></a></small>
      <div class="d-none name"><code>PPcalibrate.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function calibrates a set of radiocarbon (\({}^{14}\)C) samples, and provides an estimate
of how the underlying rate at which the samples occurred varies over calendar time (including any
specific changepoints in the rate). The method can be used as an alternative approach to summarise
calendar age information contained in a set of related \({}^{14}\)C samples, enabling inference
on the latent <em>activity</em> rate which led to their creation.</p>
<p>It takes as an input a set of \({}^{14}\)C determinations and associated \(1\sigma\)
uncertainties, as well as the radiocarbon age calibration curve to be used. The (calendar age)
occurrence of these radiocarbon (\({}^{14}\)C) samples is modelled as a Poisson process. The
underlying rate of this Poisson process \(\lambda(t)\), which represents the rate at which the
samples occurred, is considered unknown and assumed to vary over calendar time.</p>
<p>Specifically, the sample occurrence rate \(\lambda(t)\) is modelled as piecewise constant, but with
an unknown number of changepoints, which can occur at unknown times. The value of \(\lambda(t)\)
between any set of changepoints is also unknown. The function jointly calibrates the given \({}^{14}\)C
samples under this model, and simultaneously provides an estimate of \(\lambda(t)\). Fitting is performed
using reversible-jump MCMC within Gibbs.</p>
<p>It returns estimates for the calendar age of each individual radiocarbon sample in the input set;
and broader output on the estimated value of \(\lambda(t)\) which can be used by other library functions.
Analysis of the estimated changepoints in the piecewise \(\lambda(t)\) permits wider inference on whether
the occurrence rate of samples changed significantly at any particular calendar time and, if so, when and
by how much.</p>
<p>For more information read the vignette: <br><code><a href="../articles/Poisson-process-modelling.html">vignette("Poisson-process-modelling", package = "carbondate")</a></code></p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">PPcalibrate</span><span class="op">(</span></span>
<span>  <span class="va">rc_determinations</span>,</span>
<span>  <span class="va">rc_sigmas</span>,</span>
<span>  <span class="va">calibration_curve</span>,</span>
<span>  F14C_inputs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  n_iter <span class="op">=</span> <span class="fl">1e+05</span>,</span>
<span>  n_thin <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  use_F14C_space <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  show_progress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  calendar_age_range <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  calendar_grid_resolution <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  prior_h_shape <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  prior_h_rate <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  prior_n_internal_changepoints_lambda <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  k_max_internal_changepoints <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  rescale_factor_rev_jump <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  bounding_range_prob_cutoff <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  initial_n_internal_changepoints <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  grid_extension_factor <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  use_fast <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  fast_approx_prob_cutoff <span class="op">=</span> <span class="fl">0.001</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-rc-determinations">rc_determinations<a class="anchor" aria-label="anchor" href="#arg-rc-determinations"></a></dt>
<dd><p>A vector of observed radiocarbon determinations. Can be provided either as
\({}^{14}\)C ages (in \({}^{14}\)C yr BP) or as F\({}^{14}\)C concentrations.</p></dd>


<dt id="arg-rc-sigmas">rc_sigmas<a class="anchor" aria-label="anchor" href="#arg-rc-sigmas"></a></dt>
<dd><p>A vector of the (1-sigma) measurement uncertainties for the
radiocarbon determinations. Must be the same length as <code>rc_determinations</code> and
given in the same units.</p></dd>


<dt id="arg-calibration-curve">calibration_curve<a class="anchor" aria-label="anchor" href="#arg-calibration-curve"></a></dt>
<dd><p>A dataframe which must contain one column <code>calendar_age_BP</code>, and also
columns <code>c14_age</code> and <code>c14_sig</code> or <code>f14c</code> and <code>f14c_sig</code> (or both sets).
This format matches the curves supplied with this package, e.g., <a href="intcal20.html">intcal20</a>,
<a href="intcal13.html">intcal13</a>, which contain all 5 columns.</p></dd>


<dt id="arg-f-c-inputs">F14C_inputs<a class="anchor" aria-label="anchor" href="#arg-f-c-inputs"></a></dt>
<dd><p><code>TRUE</code> if the provided <code>rc_determinations</code> are F\({}^{14}\)C
concentrations and <code>FALSE</code> if they are radiocarbon ages. Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-n-iter">n_iter<a class="anchor" aria-label="anchor" href="#arg-n-iter"></a></dt>
<dd><p>The number of MCMC iterations (optional). Default is 100,000.</p></dd>


<dt id="arg-n-thin">n_thin<a class="anchor" aria-label="anchor" href="#arg-n-thin"></a></dt>
<dd><p>How much to thin the MCMC output (optional). Will store every
<code>n_thin</code>\({}^\textrm{th}\) iteration. 1 is no thinning, while a larger number will result
in more thinning. Default is 10. Must choose an integer greater than 1. Overall
number of MCMC realisations stored will be \(n_{\textrm{out}} =
\textrm{floor}( n_{\textrm{iter}}/n_{\textrm{thin}}) + 1\) so do not choose
<code>n_thin</code> too large to ensure there are enough samples from the posterior to
use for later inference.</p></dd>


<dt id="arg-use-f-c-space">use_F14C_space<a class="anchor" aria-label="anchor" href="#arg-use-f-c-space"></a></dt>
<dd><p>If <code>TRUE</code> (default) the calculations within the function are carried
out in F\({}^{14}\)C space. If <code>FALSE</code> they are carried out in \({}^{14}\)C
age space. We recommend selecting <code>TRUE</code> as, for very old samples, calibrating in
F\({}^{14}\)C space removes the potential affect of asymmetry in the radiocarbon age
uncertainty.
<em>Note:</em> This flag can be set independently of the format/scale on which
<code>rc_determinations</code> were originally provided.</p></dd>


<dt id="arg-show-progress">show_progress<a class="anchor" aria-label="anchor" href="#arg-show-progress"></a></dt>
<dd><p>Whether to show a progress bar in the console during
execution. Default is <code>TRUE</code>.</p></dd>


<dt id="arg-calendar-age-range">calendar_age_range<a class="anchor" aria-label="anchor" href="#arg-calendar-age-range"></a></dt>
<dd><p>(Optional) Overall minimum and maximum calendar ages (in cal yr BP) permitted
for the set of radiocarbon samples, i.e., <code>calendar_age_range[1]</code> &lt; \(\theta_1, \ldots, \theta_n\) &lt;
<code>calendar_age_range[1]</code>. This is used to bound the start and end of the Poisson process (so no events
will be permitted to occur outside this interval). If not selected then automated selection will be
made based on given <code>rc_determinations</code> and value of <code>bounding_range_prob_cutoff</code></p></dd>


<dt id="arg-calendar-grid-resolution">calendar_grid_resolution<a class="anchor" aria-label="anchor" href="#arg-calendar-grid-resolution"></a></dt>
<dd><p>The spacing of the calendar age grid on which to restrict
the potential calendar ages of the samples, e.g., calendar ages of samples are limited to being one of
<code>t, t + resolution, t + 2 * resolution, ...</code> Default is 1 (i.e., all calendar years in the overall
calendar range are considered). Primarily used to speed-up code if have large range, when may select
larger resolution.</p></dd>


<dt id="arg-prior-h-shape-prior-h-rate">prior_h_shape, prior_h_rate<a class="anchor" aria-label="anchor" href="#arg-prior-h-shape-prior-h-rate"></a></dt>
<dd><p>(Optional) Prior for the value of the Poisson Process rate (the height <code>rate_h</code>)
in any specific interval:
$$\textrm{rate}\_\textrm{h} \sim \textrm{Gamma}(
\textrm{shape} = \textrm{prior}\_\textrm{h}\_\textrm{shape},
\textrm{rate} = \textrm{prior}\_\textrm{h}\_\textrm{rate}).$$
If they are both <code>NA</code> then <code>prior_h_shape</code> is selected to be 1 (so <code>rate_h</code> follows an Exponential
distribution) and <code>prior_h_rate</code> chosen adaptively (internally) to match <code>n_observations</code>.</p></dd>


<dt id="arg-prior-n-internal-changepoints-lambda">prior_n_internal_changepoints_lambda<a class="anchor" aria-label="anchor" href="#arg-prior-n-internal-changepoints-lambda"></a></dt>
<dd><p>Prior mean for the number of internal changepoints
in the rate \(\lambda(t)\).
$$\textrm{n}\_\textrm{internal}\_\textrm{changepoints} \sim
\textrm{Po}(\textrm{prior}\_\textrm{n}\_\textrm{internal}\_\textrm{changepoints}\_\textrm{lambda})$$</p></dd>


<dt id="arg-k-max-internal-changepoints">k_max_internal_changepoints<a class="anchor" aria-label="anchor" href="#arg-k-max-internal-changepoints"></a></dt>
<dd><p>Maximum permitted number of internal changepoints</p></dd>


<dt id="arg-rescale-factor-rev-jump">rescale_factor_rev_jump<a class="anchor" aria-label="anchor" href="#arg-rescale-factor-rev-jump"></a></dt>
<dd><p>Factor weighting probability of dimension change
in the reversible jump update step for Poisson process <code>rate_h</code> and <code>rate_s</code></p></dd>


<dt id="arg-bounding-range-prob-cutoff">bounding_range_prob_cutoff<a class="anchor" aria-label="anchor" href="#arg-bounding-range-prob-cutoff"></a></dt>
<dd><p>Probability cut-off for choosing the bounds for the
potential calendar ages for the observations</p></dd>


<dt id="arg-initial-n-internal-changepoints">initial_n_internal_changepoints<a class="anchor" aria-label="anchor" href="#arg-initial-n-internal-changepoints"></a></dt>
<dd><p>Number of internal changepoints to initialise MCMC sampler with.
The default is 10 (so initialise with diffuse state). Will place these initial changepoints uniformly at random
within overall calendar age range.</p></dd>


<dt id="arg-grid-extension-factor">grid_extension_factor<a class="anchor" aria-label="anchor" href="#arg-grid-extension-factor"></a></dt>
<dd><p>If you adaptively select the <code>calendar_age_range</code> from <code>rc_determinations</code>, how
far you wish to extend the grid beyond this adaptive minimum and maximum. The final range will be extended
(equally on both sides) to cover <code>(1 + grid_extension_factor) * (calendar_age_range)</code></p></dd>


<dt id="arg-use-fast-fast-approx-prob-cutoff">use_fast, fast_approx_prob_cutoff<a class="anchor" aria-label="anchor" href="#arg-use-fast-fast-approx-prob-cutoff"></a></dt>
<dd><p>A flag to allow trimming the calendar age likelihood (i.e., reducing the
range of calendar ages) for each individual sample to speed up the sampler. If <code>TRUE</code> (default), for each
individual sample, those tail calendar ages (in the overall <code>calendar_age_grid</code>) with very small likelihoods will
be trimmed (speeding up the updating of the calendar ages). If <code>TRUE</code> the probability cut-off to remove the tails
is <code>fast_approx_prob_cutoff</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with 7 items. The first 4 items contain output of the model, each of
which has one dimension of size \(n_{\textrm{out}} =
\textrm{floor}( n_{\textrm{iter}}/n_{\textrm{thin}}) + 1\). The rows in these items store
the state of the MCMC from every \(n_{\textrm{thin}}\)\({}^\textrm{th}\) iteration:</p>
<dl><dt><code>rate_s</code></dt>
<dd><p>A list of length \(n_{\textrm{out}}\) each entry giving the current set of
(calendar age) changepoint locations in the piecewise-constant rate \(\lambda(t)\).</p></dd>

<dt><code>rate_h</code></dt>
<dd><p>A list of length \(n_{\textrm{out}}\) each entry giving the current set of
heights (values for the rate) in each piecewise-constant section of \(\lambda(t)\).</p></dd>

<dt><code>calendar_ages</code></dt>
<dd><p>An \(n_{\textrm{out}}\) by \(n_{\textrm{obs}}\)
matrix. Gives the current estimate for the calendar age of each individual
observation.</p></dd>

<dt><code>n_internal_changes</code></dt>
<dd><p>A vector of length \(n_{\textrm{out}}\) giving the current number of
internal changes in the value of \(\lambda(t)\).</p></dd>


</dl><p>where \(n_{\textrm{obs}}\) is the number of radiocarbon observations, i.e.,
the length of <code>rc_determinations</code>.</p>
<p>The remaining items give information about input data, input parameters (or
those calculated) and update_type</p>
<dl><dt><code>update_type</code></dt>
<dd><p>A string that always has the value "RJPP".</p></dd>

<dt><code>input_data</code></dt>
<dd><p>A list containing the \({}^{14}\)C data used, and the name of
the calibration curve used.</p></dd>

<dt><code>input_parameters</code></dt>
<dd><p>A list containing the values of the fixed
parameters <code>pp_cal_age_range</code>, <code>prior_n_internal_changepoints_lambda</code>,
<code>k_max_internal_changepoints</code>, <code>prior_h_shape</code>, <code>prior_h_rate</code>, <code>rescale_factor_rev_jump</code>,
<code>calendar_age_grid</code>, <code>calendar_grid_resolution</code>, <code>n_iter</code> and <code>n_thin</code>.</p></dd>


</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># NOTE: This example is shown with a small n_iter to speed up execution.</span></span></span>
<span class="r-in"><span><span class="co"># When you run ensure n_iter gives convergence (try function default).</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pp_output</span> <span class="op">&lt;-</span> <span class="fu">PPcalibrate</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">pp_uniform_phase</span><span class="op">$</span><span class="va">c14_age</span>,</span></span>
<span class="r-in"><span>    <span class="va">pp_uniform_phase</span><span class="op">$</span><span class="va">c14_sig</span>,</span></span>
<span class="r-in"><span>    <span class="va">intcal20</span>,</span></span>
<span class="r-in"><span>    n_iter <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>    show_progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Timothy J Heaton, Sara Al-assam.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

